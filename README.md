# TourNow
A distributed system using netflix eureka and play framework


## Description
Structure of the distributed car renting system is shown as figure 1.
<div align='center'>
    <img width=600' height='800' src=TourNow_Structure.jpg><br/>
    <font size = 2>figure 1: Overall Structure</font>
</div>
Main directory contains 7 folders, which are EurekaServer, BrokerServer, CorkServer, DublinServer, GalwayServer, 
TourNowApp and DatabasesSetUp folders.<br/>

Except for the DatabasesSetUp folder, all other folders is an **independent project** for itself. Which means there are 6 separate projects.<br/>

### **1. Maven Projects:**<br/>
**/EurekaServer, /BrokerServer, /CorkServer, /DublinServer, /GalwayServer.**<br/>
EurekaServer is the center of the distributed system, BrokerServer, DublinServer, CorkServer, GalwayServer all register their services to EurekaServer.<br/>

Port Assignment:<br/>
Default: EurekaServer: 8080, BrokerServer: 8070, DublinServer: 8091, CorkServer: 8092, Galway: 8093<br/>
Port assignment could be modified in xxServer/src/main/resources/application.properties for separate server itself.<br/>
```
server.port = #desire_port
```
Note that if the port of eureka server is changed, all application.property files of client servers need to be modified.
```
eureka.client.serviceUrl.defaultZone = http://localhost:#eureka_server_port_Num#/eureka"
```

### **2. Sbt Project:**<br/>
**/TourNowApp**<br/>
Port Assignment:<br/>
TourNowApp: 9000<br/>
The TourNowAPP project is based on the play framework, please refer to TourNowApp/README.md for further detail.

### **3. DataBases:**<br/>
According to figure 1, in order to simulate the distributed system, DublinServer, CorkServer, GalwayServer, TourNowApp have their own databases. Therefore, in /DataBaseSet directory, cork.sql, dublin.sql, galway.sql, car.sql creates their own database with some test data separately.<br/>
For instance, cork.sql create a cork database which contains a table named cork, and it stores some cars information that are available for renting in Cork.<br/>
car.sql creates a tournow database with a table named cars, which stores the cars info that are currently rented.<br/>

Port Assignment/UserName/PassWord:<br/>
**For /DublinServer, /CorkServer, /GalwayServer**, modify the file xxServer/src/main/java/com/tournow/controllers/ConnectMySQL.java
```java
// modify username and password
private static String user = "username_of_your_db";
private static String password = "password_of_your_db";
```
```java
// modify port
String url = "jdbc:mysql://localhost:#desire_port#/dublin";
```
**For /TourNowApp**, modify the file /TourNowApp/conf/application.conf at line 369-371:
```
default.url="jdbc:mysql://localhost:#desire_port#/tournow"
default.username = username_of_your_db
default.password = "password_of_your_db"
```
The default port for all 4 databases above is 3306 and the default username is "root" and the default password is "".


### **4. IPStack:**<br/>
The broker server provide the service with return available cars info for rent in the location based on the user's ip address. the location of the IP address is generated by IPStack API used by broker server.<br/>
For that service, you will need to register for IPStack(https://ipstack.com/) and get the access key and input it to /BrokerServer/src/main/java/com/tournow/controllers/ComsumerControllerClient.java
at line 38:
```java
String access_key = "#input_your_access_key_here#";
```
Also, the cars is only available for renting in dublin, cork, and galway. Therefore, if the ip address is not theses three places, the TourNow search page will return nothing.<br/>
Futhermore, in localhost environment, the ip is 127.0.0.1, for which the IPStack returns null info. Therefore, for testing purpose, inside the default getting location by IP function, the IP address is being hard code.<br/>
In practical, you could **comment line 34** and **uncomment line 36** in file /TourNowApp/app/views/cars/seachPage.scala.html. Then the IPStack could receive the real IP and returns the real location.
```scala
//Function for get all the cars available in City where is obtained accroding to the user's ip
function getByIP(ip, rurl, newId)
{
    $.ajax({
        //since that the request is from localhsot, the ip is 127.0.0.0
        //for test use, we hard code the request ip
        url : "http://localhost:8070/getCarsByIP?ip="+"193.1.167.16",

        //In practical, the following line should be un-comment
        //url : "http://localhost:8070/getCarsByIP?ip="+ip,					
        type : "GET",
        dataType : "json",
        success : function(cars) {
            showCars(cars, rurl, newId);
            console.log("success! result: "+JSON.stringify(cars));
        },
        error : function(exception){
            console.log("error geting access to the broker server for getting cars!");
        }
    });
}
```

## Pre-Installation requirement
sbt, Maven, MySQL, jdbc


## Compile Process
### 1. Database
1. run sql files in DatabasesSetUp folder.
### 2. Maven Project
1. In each directory /EurekaServer, /BrokerServer, /DublinServer, /CorkServer, /GalwayServer. Use shell to run:
   ```
   mvn compile
   ```
2. run EurekaServerApplication.java in /EurekaServer/src/main/java/com/tournow
3. run BrokerServer.java in /BrokerServer/src/main/java/com/tournow
4. run DublinServer.java in /DublinServer/src/main/java/com/tournow.
5. run CorkServer.java in /CorkServer/src/main/java/com/tournow
6. run GalwayServer.java in /GalwayServer/src/main/java/com/tournow
### 3. Sbt Project
1. In /TourNowApp directory. Use shell to run:
    ```
    sbt update
    sbt compile
    sbt run
    ```